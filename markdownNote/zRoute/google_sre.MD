## 第一部分 概览

### 第一章 介绍

#### sre团队承担的主要职责

1. 可用性改进
2. 延迟优化
3. 性能优化
4. 效率优化
5. 变更管理
6. 监控
7. 紧急事务处理
8. 容量规划与管理

#### 变更管理

- 采用渐进式发布机制（灰度发布，极限金丝雀发布，当然需要做到自动化发布而非手工处理，依赖软件工程方法论推广）
- 迅速而准确的反应问题（SLO自动上报，metrics自动发现，告警规则注入）
- 当出现问题时，能够安全迅速地回退（遵循软件工程方法论的发布系统）

#### 资源部署

遵循基础设施即代码理论，通过工程，而非手工的方案定义资源。因为公有云或者API化的基础设施体系，使得手工劳动不仅仅是一个吃力而且乏味的劳动。而且在结构化资源来说，手工劳动其实花费的代价其实更大。综合而言，更多的是使用代码定义而不仅仅是多做文档定义。

### 第二章 Google生产环境：SRE视角

#### Google典型数据中心拓扑结构

- 约10台物理服务器组成一个机柜（rack），注：陆金所是12台，因为用满48口的交换机，而且是X联方法AB机柜组成一对
- 数台机柜组成一个机柜排（row）
- 一排或多排机柜组成一个集群（cluster）
- 一般来说，多个集群组合成了一个数据中心（cluster）。注：在阿里云、腾讯云、AWS里叫可用区(available zone)
- 多个相邻的可用区组成了一个园区（Campus）。注：在阿里云、腾讯云、AWS叫区域（region）

## 第二部分 指导思想

名词解释

| 缩写 | 解释         | 说明                                                         |
| ---- | ------------ | ------------------------------------------------------------ |
| SLI  | 服务质量指标 | 该服务的某项服务质量的一个具体量化指标，例如请求延迟、错误率、系统吞吐量等（RED原则） |
| SLO  | 服务质量目标 |                                                              |
| SLA  | 服务质量协议 |                                                              |

### 第三章 拥抱风险

旨在寻求快速创新和高效的服务运营业务中间的风险的平衡。优化用户的整体幸福感，平衡系统的功能、服务和性能。计算好 成本/收益比。

需要关注的风险主要是，**计划外停机**这个指标。

对于服务型系统而言，可用性指标通常是基于系统正常运行时间比例的计算得出的。

1. 基于时间可用性。 可用性 = 系统正常运行的时间 / ( 系统正常运行的时间 + 停机时间 )； 注意： 在Google内部，这个指标通常毫无意义。

2. 合计可用性。 可用性 = 成功请求数 / 总的请求数。 Google内部，通常针对某一个服务做季度性的可用性目标，然后每周甚至每天对性能进行跟踪。

   #### 辨识风险的容忍度

   SRE需要与产品负责人一起，将一组商业目标转化为明确可实现的的工程目标。

   辨识可用性目标需要枚举一些考虑问题：

   1. 用户期望的服务水平是什么？
   2. 这项服务是否直接关系到收入（我们的收入或者客户的收入）？
   3. 有偿服务，还是免费服务？
   4. 市场上的竞争对手提供的服务水平如何？
   5. 针对消费者还是针对企业？

   标重点： **金丝雀发布**，在一个典型工作负载的服务子集中进行测试。

   #### 关键点

   - 管理服务的可用性主要在于管理风险，需要平衡好成本收益比。
   - 100% 可能永远都不是一个正确的可靠性指标
   - 错误预算在SRE与产品研发团队之间调整激励，强调共有责任，错误预算使得讨论发布速率更直观，尽快达成一致。

   ### 第四章 服务质量指标

   ## 第三部分 具体实践
   
   服务可靠度层级模型，从底层到高层：
   
   - 监控
   - 应急事件处理。如果可以找到一种方式使得值班不在必要，SRE一定会第一时间采用。
   - 事后总结/问题根因分析
   - 测试+发布
   - 容量规划
   - 软件开发
   - 产品设计
   
   ### 第十章 基于时间序列数据进行有效报警
   
   也许针对promql，可以测试一下左右都是表达式的告警规则，以便整体的报警规则是一个动态的水位线制度的。
   
   ### 第十一章 on-call 制度
   
   一般来说，对于任何直接面向最终用户的服务，或者时间非常急迫的服务来说，介入响应的时间设置为 5分钟。
   
   对于非直接面向最终用户，或者不是特别紧急的服务来说，介入响应的时间设置为 30分钟。
   
   优选的处理方法： 理性、有意识地进行认知猜测。记住！**故障会重现**
   
   对于减轻 on-call 时间压力的资源:
   
   1. 清晰的问题升级路线。
   2. 清晰定义的应急事件处理步骤。
   3. 无指责，对事不对人的文化氛围。
   
   出现错误正确的做法是，**尽最大可能让系统恢复服务**。缓解系统问题应该是第一要务，当然快速定位问题根因仍然需要保存问题现场，比如服务日志等，以便后续进行问题根因分析时使用。
   
   问题分析三工具：
   
   - monitoring
   - tracing
   - logging
   
   